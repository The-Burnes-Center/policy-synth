# DocumentTreeSplitAgent

The `DocumentTreeSplitAgent` class is an extension of the `BaseIngestionAgent` class. It is designed to split a document into chunks based on a strategy generated by a language model. The class includes methods for generating and reviewing chunking strategies, as well as for splitting the document into chunks and sub-chunks.

## Properties

| Name                      | Type   | Description                                                                 |
|---------------------------|--------|-----------------------------------------------------------------------------|
| maxSplitRetries           | number | Maximum number of retries for splitting the document.                       |
| minChunkCharacterLength   | number | Minimum character length for a chunk.                                       |
| maxChunkLinesLength       | number | Maximum number of lines for a chunk.                                        |
| strategySystemMessage     | string | System message for generating the chunking strategy.                        |
| strategyUserMessage       | Function | Function to create a user message for generating the chunking strategy.     |
| strategyWithReviewUserMessage | Function | Function to create a user message for generating the chunking strategy with review comments. |
| reviewStrategySystemMessage | string | System message for reviewing the chunking strategy.                         |
| reviewStrategyUserMessage | Function | Function to create a user message for reviewing the chunking strategy.      |

## Methods

| Name                          | Parameters                                                                 | Return Type | Description                                                                 |
|-------------------------------|----------------------------------------------------------------------------|-------------|-----------------------------------------------------------------------------|
| generateDiff                  | str1: string, str2: string                                                 | string      | Generates a diff between two strings.                                       |
| fetchLlmChunkingStrategy      | data: string, review: string \| undefined, lastJson: LlmDocumentChunksStrategy[] \| undefined | Promise<{ chunkingStrategy: string, chunkingStrategyReview: string, lastChunkingStrategyJson: LlmDocumentChunksStrategy[] }> | Fetches the chunking strategy from the language model. |
| aggregateChunkData            | chunks: LlmDocumentChunksStrategy[]                                        | string      | Aggregates chunk data from a list of chunks.                                |
| normalizeLineBreaks           | text: string                                                               | string      | Normalizes line breaks in a string.                                         |
| splitDocumentIntoChunks       | data: string, isSubChunk: boolean = false, totalLinesInChunk?: number      | Promise<LlmDocumentChunksStrategy[] \| undefined> | Splits the document into chunks and sub-chunks.                             |

## Example

```typescript
import { DocumentTreeSplitAgent } from '@policysynth/agents/rag/ingestion/docTreeSplitter.js';

const agent = new DocumentTreeSplitAgent();
const documentData = "Your document data here...";
const chunkingStrategy = await agent.splitDocumentIntoChunks(documentData);

console.log(chunkingStrategy);
```

## Detailed Method Descriptions

### generateDiff

Generates a diff between two strings, providing context around the first difference found.

**Parameters:**
- `str1` (string): The first string to compare.
- `str2` (string): The second string to compare.

**Returns:**
- `string`: A description of the difference between the two strings.

### fetchLlmChunkingStrategy

Fetches the chunking strategy from the language model, optionally including a review of the last attempt.

**Parameters:**
- `data` (string): The document data to analyze.
- `review` (string | undefined): Review comments from the last attempt, if any.
- `lastJson` (LlmDocumentChunksStrategy[] | undefined): The last chunking strategy JSON, if any.

**Returns:**
- `Promise<{ chunkingStrategy: string, chunkingStrategyReview: string, lastChunkingStrategyJson: LlmDocumentChunksStrategy[] }>`: The chunking strategy, review, and last chunking strategy JSON.

### aggregateChunkData

Aggregates chunk data from a list of chunks.

**Parameters:**
- `chunks` (LlmDocumentChunksStrategy[]): The list of chunks to aggregate.

**Returns:**
- `string`: The aggregated chunk data.

### normalizeLineBreaks

Normalizes line breaks in a string by replacing all newline characters with an empty string.

**Parameters:**
- `text` (string): The text to normalize.

**Returns:**
- `string`: The normalized text.

### splitDocumentIntoChunks

Splits the document into chunks and sub-chunks based on the chunking strategy generated by the language model.

**Parameters:**
- `data` (string): The document data to split.
- `isSubChunk` (boolean, default: false): Whether the current chunk is a sub-chunk.
- `totalLinesInChunk` (number, optional): The total number of lines in the chunk.

**Returns:**
- `Promise<LlmDocumentChunksStrategy[] | undefined>`: The chunking strategy JSON, or undefined if the strategy could not be validated.