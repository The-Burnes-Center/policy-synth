{"version":3,"file":"PsServerApi.js","sourceRoot":"","sources":["../../src/operations/PsServerApi.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,oBAAoB,EAAE,MAAM,2BAA2B,CAAC;AAGjE,MAAM,OAAO,WAAY,SAAQ,oBAAoB;IAEnD,YAAY,UAAkB,MAAM;QAClC,KAAK,EAAE,CAAC;QAFV,mBAAc,GAAG,UAAU,CAAC;QAG1B,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC;IAC7B,CAAC;IAEM,KAAK,CAAC,QAAQ,CAAC,OAAe;QACnC,OAAO,CAAC,MAAM,IAAI,CAAC,YAAY,CAC7B,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,OAAO,EAAE,EACrD,EAAE,EACF,KAAK,CACN,CAAiC,CAAC;IACrC,CAAC;IAEM,KAAK,CAAC,kBAAkB,CAC7B,OAAe,EACf,OAAe;QAEf,OAAO,IAAI,CAAC,YAAY,CACtB,GAAG,IAAI,CAAC,WAAW,WAAW,OAAO,cAAc,OAAO,EAAE,EAC5D;YACE,MAAM,EAAE,QAAQ;SACjB,CACF,CAAC;IACJ,CAAC;IAEM,KAAK,CAAC,eAAe,CAC1B,OAAe,EACf,OAAe,EACf,IAAmB;QAEnB,OAAO,IAAI,CAAC,YAAY,CACtB,GAAG,IAAI,CAAC,WAAW,WAAW,OAAO,YAAY,EACjD;YACE,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;SACxC,CACF,CAAC;IACJ,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,OAAe;QACjC,OAAO,CAAC,MAAM,IAAI,CAAC,YAAY,CAC7B,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,OAAO,EAAE,EACrD,EAAE,EACF,KAAK,CACN,CAAyC,CAAC;IAC7C,CAAC;IACM,KAAK,CAAC,wBAAwB,CACnC,OAAe,EACf,aAA0D;QAE1D,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,OAAO,gBAAgB,EACnE;YACE,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC;SACpC,EACD,KAAK,CACW,CAAC;IACrB,CAAC;IAEM,KAAK,CAAC,WAAW,CACtB,IAAY,EACZ,YAAoB,EACpB,QAAmC,EACnC,aAAqB,EACrB,OAAgB;QAEhB,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,cAAc,EACtC;YACE,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;gBACnB,IAAI;gBACJ,YAAY;gBACZ,QAAQ;gBACR,aAAa;gBACb,OAAO;aACR,CAAC;SACH,EACD,KAAK,CACwB,CAAC;IAClC,CAAC;IAEM,KAAK,CAAC,gBAAgB,CAC3B,OAAe;QAEf,OAAO,IAAI,CAAC,YAAY,CACtB,GAAG,IAAI,CAAC,WAAW,WAAW,OAAO,YAAY,CAChB,CAAC;IACtC,CAAC;IAEM,KAAK,CAAC,iBAAiB;QAC5B,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,mBAAmB,EAC5D;YACE,MAAM,EAAE,KAAK;SACd,EACD,KAAK,CAC4B,CAAC;IACtC,CAAC;IAEM,KAAK,CAAC,qBAAqB;QAChC,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,uBAAuB,EAChE;YACE,MAAM,EAAE,KAAK;SACd,EACD,KAAK,CAC+B,CAAC;IACzC,CAAC;IAEM,KAAK,CAAC,yBAAyB;QAGpC,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,2BAA2B,EACpE;YACE,MAAM,EAAE,KAAK;SACd,EACD,KAAK,CACwC,CAAC;IAClD,CAAC;IAEM,UAAU,CACf,GAA8B;QAE9B,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,MAAM,EACzB;YACE,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC;SAC1B,EACD,KAAK,CACgC,CAAC;IAC1C,CAAC;IAEM,kBAAkB,CACvB,MAAuB,EACvB,MAAc,EACd,WAAqB;QAErB,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,MAAM,iBAAiB,EACnE;YACE,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;gBACnB,MAAM;gBACN,WAAW;aACZ,CAAC;SACH,EACD,KAAK,CACW,CAAC;IACrB,CAAC;IAEM,mBAAmB,CACxB,UAAkB,EAClB,GAA8B;QAE9B,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,sBAAsB,EAC/D;YACE,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;gBACnB,OAAO,EAAE,GAAG,CAAC,OAAO;gBACpB,kBAAkB,EAAE,GAAG,CAAC,kBAAkB;gBAC1C,UAAU;aACX,CAAC;SACH,EACD,KAAK,EACL,SAAS,CACS,CAAC;IACvB,CAAC;IAEM,kBAAkB,CACvB,MAAuB,EACvB,YAAoB;QAEpB,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,MAAM,qBAAqB,EACvE;YACE,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;gBACnB,YAAY;aACb,CAAC;SACH,EACD,KAAK,CACsC,CAAC;IAChD,CAAC;IAEM,eAAe,CACpB,MAAuB,EACvB,YAAoB,EACpB,MAAgB,EAChB,IAAiB;QAEjB,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,MAAM,kBAAkB,EACpE;YACE,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;gBACnB,YAAY;gBACZ,MAAM;gBACN,IAAI;aACL,CAAC;SACH,EACD,KAAK,CACsC,CAAC;IAChD,CAAC;IAEM,KAAK,CAAC,aAAa,CAAC,OAAe;QACxC,MAAM,QAAQ,GAAG,CAAC,MAAM,IAAI,CAAC,YAAY,CACvC,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,OAAO,QAAQ,EAC3D;YACE,MAAM,EAAE,KAAK;SACd,EACD,KAAK,CACN,CAA0B,CAAC;QAC5B,OAAO,UAAU,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IACxC,CAAC;IAEM,wBAAwB,CAC7B,SAA0B,EAC1B,SAAiB,EACjB,OAA4B,EAC5B,UAAkB,EAClB,MAAe,EACf,MAAiB,EACjB,gBAA2B;QAE3B,kDAAkD;QAClD,OAAO,GAAG,OAAO,CAAC,MAAM,CACtB,WAAW,CAAC,EAAE,CACZ,WAAW,CAAC,IAAI,IAAI,UAAU,IAAI,WAAW,CAAC,IAAI,IAAI,aAAa,CACtE,CAAC;QAEF,MAAM,iBAAiB,GAAG,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,EAAE;YAClD,OAAO;gBACL,MAAM,EAAE,WAAW,CAAC,MAAM,IAAI,KAAK,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,MAAM;gBAC1D,OAAO,EAAE,WAAW,CAAC,UAAU;oBAC7B,CAAC,CAAC,WAAW,CAAC,UAAU;oBACxB,CAAC,CAAC,WAAW,CAAC,OAAO;aACxB,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,SAAS,mBAAmB,EACxE;YACE,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;gBACnB,UAAU;gBACV,SAAS;gBACT,OAAO,EAAE,iBAAiB;gBAC1B,MAAM;gBACN,MAAM;gBACN,gBAAgB;aACjB,CAAC;SACH,EACD,KAAK,CAC2B,CAAC;IACrC,CAAC;IAEM,kBAAkB,CACvB,SAA0B,EAC1B,SAAiB,EACjB,OAA4B,EAC5B,UAAkB,EAClB,MAAc,EACd,MAAgB;QAEhB,kDAAkD;QAClD,OAAO,GAAG,OAAO,CAAC,MAAM,CACtB,WAAW,CAAC,EAAE,CACZ,WAAW,CAAC,IAAI,IAAI,UAAU,IAAI,WAAW,CAAC,IAAI,IAAI,aAAa,CACtE,CAAC;QAEF,MAAM,iBAAiB,GAAG,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,EAAE;YAClD,OAAO;gBACL,MAAM,EAAE,WAAW,CAAC,MAAM,IAAI,KAAK,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,MAAM;gBAC1D,OAAO,EAAE,WAAW,CAAC,UAAU;oBAC7B,CAAC,CAAC,WAAW,CAAC,UAAU;oBACxB,CAAC,CAAC,WAAW,CAAC,OAAO;aACxB,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW;YACd,GAAG,IAAI,CAAC,cAAc,GAAG,SAAS,qBAAqB,EACzD;YACE,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;gBACnB,UAAU;gBACV,SAAS;gBACT,OAAO,EAAE,iBAAiB;gBAC1B,MAAM;gBACN,MAAM;aACP,CAAC;SACH,EACD,KAAK,CAC2B,CAAC;IACrC,CAAC;IAED,KAAK,CAAC,eAAe,CACnB,OAAe,EACf,gBAAwB,EACxB,IAAY,EACZ,IAAwB;QAExB,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,eAAe,OAAO,IAAI,IAAI,YAAY,EAAE;YACvE,MAAM,EAAE,MAAM;YACd,OAAO,EAAE;gBACP,cAAc,EAAE,kBAAkB;aACnC;YACD,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,gBAAgB,EAAE,IAAI,EAAE,CAAC;SACjD,CAAC,CAAC;QAEH,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE,CAAC;YACjB,MAAM,IAAI,KAAK,CAAC,oBAAoB,IAAI,YAAY,CAAC,CAAC;QACxD,CAAC;QAED,OAAO,QAAQ,CAAC,IAAI,EAAE,CAAC;IACzB,CAAC;IAEM,UAAU,CACf,OAAe,EACf,WAA8B;QAE9B,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,OAAO,EAAE,EACrD;YACE,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC;SAClC,EACD,KAAK,CACW,CAAC;IACrB,CAAC;IAEM,KAAK,CAAC,uBAAuB,CAClC,QAA+B,EAC/B,MAAc,EACd,aAGC;QAED,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW;YACd,GAAG,IAAI,CAAC,cAAc,GAAG,MAAM,IAAI,QAAQ,gBAAgB,EAC7D;YACE,MAAM,EAAE,KAAK;YACb,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC;SACpC,EACD,KAAK,CACW,CAAC;IACrB,CAAC;IAEM,KAAK,CAAC,cAAc,CAAC,OAAe;QACzC,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,OAAO,SAAS,EAC5D;YACE,MAAM,EAAE,KAAK;SACd,EACD,KAAK,CACoB,CAAC;IAC9B,CAAC;IAED,KAAK,CAAC,YAAY,CAAC,OAAe,EAAE,MAAkC;QACpE,OAAO,IAAI,CAAC,YAAY,CAAC,eAAe,OAAO,UAAU,EAAE;YACzD,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;SACzC,CAAC,CAAC;IACL,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,OAAe;QAC9B,OAAO,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IAC7C,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,OAAe;QAC9B,OAAO,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IAC7C,CAAC;IAED,KAAK,CAAC,SAAS,CAAC,OAAe;QAC7B,OAAO,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IAC5C,CAAC;IAEM,UAAU,CAAC,MAAuB,EAAE,MAAc;QACvD,OAAO,IAAI,CAAC,YAAY,CACtB,IAAI,CAAC,WAAW,GAAG,GAAG,IAAI,CAAC,cAAc,GAAG,MAAM,EAAE,EACpD;YACE,MAAM,EAAE,QAAQ;YAChB,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,CAAC;SACjC,EACD,KAAK,CACW,CAAC;IACrB,CAAC;CACF","sourcesContent":["import { BaseChatBotServerApi } from '../chatBot/BaseChatBotApi';\nimport { PsAiModelSize } from '@policysynth/agents/aiModelTypes.js';\n\nexport class PsServerApi extends BaseChatBotServerApi {\n  baseAgentsPath = '/agents/';\n  constructor(urlPath: string = '/api') {\n    super();\n    this.baseUrlPath = urlPath;\n  }\n\n  public async getAgent(groupId: number): Promise<PsAgentAttributes> {\n    return (await this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}`,\n      {},\n      false\n    )) as unknown as PsAgentAttributes;\n  }\n\n  public async removeAgentAiModel(\n    agentId: number,\n    modelId: number\n  ): Promise<void> {\n    return this.fetchWrapper(\n      `${this.baseUrlPath}/agents/${agentId}/ai-models/${modelId}`,\n      {\n        method: 'DELETE',\n      }\n    );\n  }\n\n  public async addAgentAiModel(\n    agentId: number,\n    modelId: number,\n    size: PsAiModelSize\n  ): Promise<void> {\n    return this.fetchWrapper(\n      `${this.baseUrlPath}/agents/${agentId}/ai-models`,\n      {\n        method: 'POST',\n        body: JSON.stringify({ modelId, size }),\n      }\n    );\n  }\n\n  public async getCrt(groupId: number): Promise<LtpCurrentRealityTreeData> {\n    return (await this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}`,\n      {},\n      false\n    )) as unknown as LtpCurrentRealityTreeData;\n  }\n  public async updateAgentConfiguration(\n    agentId: number,\n    updatedConfig: Partial<PsAgentAttributes['configuration']>\n  ): Promise<void> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${agentId}/configuration`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(updatedConfig),\n      },\n      false\n    ) as Promise<void>;\n  }\n\n  public async createAgent(\n    name: string,\n    agentClassId: number,\n    aiModels: { [key: string]: number },\n    parentAgentId: number,\n    groupId?: number\n  ): Promise<PsAgentAttributes> {\n    return this.fetchWrapper(\n      this.baseUrlPath + this.baseAgentsPath,\n      {\n        method: 'POST',\n        body: JSON.stringify({\n          name,\n          agentClassId,\n          aiModels,\n          parentAgentId,\n          groupId,\n        }),\n      },\n      false\n    ) as Promise<PsAgentAttributes>;\n  }\n\n  public async getAgentAiModels(\n    agentId: number\n  ): Promise<PsAiModelAttributes[]> {\n    return this.fetchWrapper(\n      `${this.baseUrlPath}/agents/${agentId}/ai-models`\n    ) as Promise<PsAiModelAttributes[]>;\n  }\n\n  public async getActiveAiModels(): Promise<PsAiModelAttributes[]> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}registry/aiModels`,\n      {\n        method: 'GET',\n      },\n      false\n    ) as Promise<PsAiModelAttributes[]>;\n  }\n\n  public async getActiveAgentClasses(): Promise<PsAgentClassAttributes[]> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}registry/agentClasses`,\n      {\n        method: 'GET',\n      },\n      false\n    ) as Promise<PsAgentClassAttributes[]>;\n  }\n\n  public async getActiveConnectorClasses(): Promise<\n    PsAgentConnectorClassAttributes[]\n  > {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}registry/connectorClasses`,\n      {\n        method: 'GET',\n      },\n      false\n    ) as Promise<PsAgentConnectorClassAttributes[]>;\n  }\n\n  public createTree(\n    crt: LtpCurrentRealityTreeData\n  ): Promise<LtpCurrentRealityTreeData> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `/crt`,\n      {\n        method: 'POST',\n        body: JSON.stringify(crt),\n      },\n      false\n    ) as Promise<LtpCurrentRealityTreeData>;\n  }\n\n  public updateNodeChildren(\n    treeId: string | number,\n    nodeId: string,\n    childrenIds: string[]\n  ): Promise<void> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${treeId}/updateChildren`,\n      {\n        method: 'PUT',\n        body: JSON.stringify({\n          nodeId,\n          childrenIds,\n        }),\n      },\n      false\n    ) as Promise<void>;\n  }\n\n  public reviewConfiguration(\n    wsClientId: string,\n    crt: LtpCurrentRealityTreeData\n  ): Promise<string> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}/reviewConfiguration`,\n      {\n        method: 'PUT',\n        body: JSON.stringify({\n          context: crt.context,\n          undesirableEffects: crt.undesirableEffects,\n          wsClientId,\n        }),\n      },\n      false,\n      undefined\n    ) as Promise<string>;\n  }\n\n  public createDirectCauses(\n    treeId: string | number,\n    parentNodeId: string\n  ): Promise<LtpCurrentRealityTreeDataNode[]> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${treeId}/createDirectCauses`,\n      {\n        method: 'POST',\n        body: JSON.stringify({\n          parentNodeId,\n        }),\n      },\n      false\n    ) as Promise<LtpCurrentRealityTreeDataNode[]>;\n  }\n\n  public addDirectCauses(\n    treeId: string | number,\n    parentNodeId: string,\n    causes: string[],\n    type: CrtNodeType\n  ): Promise<LtpCurrentRealityTreeDataNode[]> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${treeId}/addDirectCauses`,\n      {\n        method: 'POST',\n        body: JSON.stringify({\n          parentNodeId,\n          causes,\n          type,\n        }),\n      },\n      false\n    ) as Promise<LtpCurrentRealityTreeDataNode[]>;\n  }\n\n  public async getAgentCosts(agentId: number): Promise<number> {\n    const response = (await this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${agentId}/costs`,\n      {\n        method: 'GET',\n      },\n      false\n    )) as { totalCost: string };\n    return parseFloat(response.totalCost);\n  }\n\n  public sendGetRefinedCauseQuery(\n    crtTreeId: string | number,\n    crtNodeId: string,\n    chatLog: PsAiChatWsMessage[],\n    wsClientId: string,\n    effect?: string,\n    causes?: string[],\n    validationErrors?: string[]\n  ): Promise<LtpChatBotCrtMessage> {\n    // Filter out all chatMessages with type==thinking\n    chatLog = chatLog.filter(\n      chatMessage =>\n        chatMessage.type != 'thinking' && chatMessage.type != 'noStreaming'\n    );\n\n    const simplifiedChatLog = chatLog.map(chatMessage => {\n      return {\n        sender: chatMessage.sender == 'bot' ? 'assistant' : 'user',\n        message: chatMessage.rawMessage\n          ? chatMessage.rawMessage\n          : chatMessage.message,\n      };\n    });\n\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${crtTreeId}/getRefinedCauses`,\n      {\n        method: 'POST',\n        body: JSON.stringify({\n          wsClientId,\n          crtNodeId,\n          chatLog: simplifiedChatLog,\n          effect,\n          causes,\n          validationErrors,\n        }),\n      },\n      false\n    ) as Promise<LtpChatBotCrtMessage>;\n  }\n\n  public runValidationChain(\n    crtTreeId: string | number,\n    crtNodeId: string,\n    chatLog: PsAiChatWsMessage[],\n    wsClientId: string,\n    effect: string,\n    causes: string[]\n  ): Promise<LtpChatBotCrtMessage> {\n    // Filter out all chatMessages with type==thinking\n    chatLog = chatLog.filter(\n      chatMessage =>\n        chatMessage.type != 'thinking' && chatMessage.type != 'noStreaming'\n    );\n\n    const simplifiedChatLog = chatLog.map(chatMessage => {\n      return {\n        sender: chatMessage.sender == 'bot' ? 'assistant' : 'user',\n        message: chatMessage.rawMessage\n          ? chatMessage.rawMessage\n          : chatMessage.message,\n      };\n    });\n\n    return this.fetchWrapper(\n      this.baseUrlPath +\n        `${this.baseAgentsPath}${crtTreeId}/runValidationChain`,\n      {\n        method: 'POST',\n        body: JSON.stringify({\n          wsClientId,\n          crtNodeId,\n          chatLog: simplifiedChatLog,\n          effect,\n          causes,\n        }),\n      },\n      false\n    ) as Promise<LtpChatBotCrtMessage>;\n  }\n\n  async createConnector(\n    agentId: number,\n    connectorClassId: number,\n    name: string,\n    type: 'input' | 'output'\n  ): Promise<PsAgentConnectorAttributes> {\n    const response = await fetch(`/api/agents/${agentId}/${type}Connectors`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ connectorClassId, name }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to create ${type} connector`);\n    }\n\n    return response.json();\n  }\n\n  public updateNode(\n    agentId: number,\n    updatedNode: PsAgentAttributes\n  ): Promise<void> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${agentId}`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(updatedNode),\n      },\n      false\n    ) as Promise<void>;\n  }\n\n  public async updateNodeConfiguration(\n    nodeType: 'agent' | 'connector',\n    nodeId: number,\n    updatedConfig: Partial<\n      | PsAgentAttributes['configuration']\n      | PsAgentConnectorAttributes['configuration']\n    >\n  ): Promise<void> {\n    return this.fetchWrapper(\n      this.baseUrlPath +\n        `${this.baseAgentsPath}${nodeId}/${nodeType}/configuration`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(updatedConfig),\n      },\n      false\n    ) as Promise<void>;\n  }\n\n  public async getAgentStatus(agentId: number): Promise<PsAgentStatus> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${agentId}/status`,\n      {\n        method: 'GET',\n      },\n      false\n    ) as Promise<PsAgentStatus>;\n  }\n\n  async controlAgent(agentId: number, action: 'start' | 'pause' | 'stop') {\n    return this.fetchWrapper(`/api/agents/${agentId}/control`, {\n      method: 'POST',\n      body: JSON.stringify({ action: action }),\n    });\n  }\n\n  async startAgent(agentId: number) {\n    return this.controlAgent(agentId, 'start');\n  }\n\n  async pauseAgent(agentId: number) {\n    return this.controlAgent(agentId, 'pause');\n  }\n\n  async stopAgent(agentId: number) {\n    return this.controlAgent(agentId, 'stop');\n  }\n\n  public deleteNode(treeId: string | number, nodeId: string): Promise<void> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${treeId}`,\n      {\n        method: 'DELETE',\n        body: JSON.stringify({ nodeId }),\n      },\n      false\n    ) as Promise<void>;\n  }\n}\n"]}